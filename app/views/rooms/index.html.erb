<%# app/views/rooms/index.html.erb %>

<%# ===============================
   検索フォーム（フル幅・header直下）
=============================== %>
<% content_for :full_width do %>
  <div class="search-nav">
    <div class="search-nav-inner">
      <%= form_with url: rooms_path, method: :get, local: true do |f| %>
        <div class="form-row d-flex align-items-center">           
          <%# エリア検索 %>
          <div class="form-group">
            <div class="input-with-icon">
              <!-- SVG -->
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" aria-hidden="true">
                <path d="M128 252.6C128 148.4 214 64 320 64C426 64 512 148.4 512 252.6C512 371.9 391.8 514.9 341.6 569.4C329.8 582.2 310.1 582.2 298.3 569.4C248.1 514.9 127.9 371.9 127.9 252.6zM320 320C355.3 320 384 291.3 384 256C384 220.7 355.3 192 320 192C284.7 192 256 220.7 256 256C256 291.3 284.7 320 320 320z"/>
              </svg>
              <%= text_field_tag :area, params[:area],
                    class: "icon-input",
                    placeholder: "エリアを入力" %>
            </div>
          </div>

          <%# フリーワード検索 %>
          <div class="form-group">
            <div class="input-with-icon">
            <!--SVG-->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.-->
              <path d="M480 272C480 317.9 465.1 360.3 440 394.7L566.6 521.4C579.1 533.9 579.1 554.2 566.6 566.7C554.1 579.2 533.8 579.2 521.3 566.7L394.7 440C360.3 465.1 317.9 480 272 480C157.1 480 64 386.9 64 272C64 157.1 157.1 64 272 64C386.9 64 480 157.1 480 272zM272 416C351.5 416 416 351.5 416 272C416 192.5 351.5 128 272 128C192.5 128 128 192.5 128 272C128 351.5 192.5 416 272 416z"/>
            </svg>
            <%= text_field_tag :keyword, params[:keyword],
                    class: "icon-input",
                    placeholder: "キーワード名を入力" %>
            </div>
          </div>

          <%# 検索 %>
          <div class="form-group">
            <input type="submit" name="commit" value="検索" class=" search-button" data-disable-with="検索">
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<%# ===============================
   メインコンテンツ（通常幅）
=============================== %>
<div class="rooms-index">
  <h1>
    <% if params[:area].present? || params[:keyword].present? %>
      検索結果：<%= @rooms.count %>件が見つかりました
    <% else %>
      部屋一覧
    <% end %>
  </h1>

  <ul class="rooms list-unstyled">
    <% @rooms.each do |room| %>
      <li class="room-card">
        <%# 画像表示 %>
        <% if room.image.attached? %>
          <%= image_tag url_for(room.image), class: "room-image" %>
        <% else %>
          <%= image_tag "default_room.png", class: "room-image" %>
        <% end %>

        <%# 施設情報 %>
        <div class="room-info">
          <h3><%= room.name %></h3>

          <p class="room-address text-muted small"><%= room.address %></p>

          <% if room.description.present? %>
            <p class="small mb-2"><%= truncate(room.description, length: 60) %></p>
          <% end %>

          <p class="room-price"><%= number_to_currency(room.price) %>〜 / 泊</p>

          <%= link_to "詳細を見る", room_path(room), class: "btn btn-outline-primary btn-sm mt-2" %>
        </div>
      </li>
    <% end %>
  </ul>

  <% if @rooms.empty? %>
    <p>条件に一致する施設がありません</p>
  <% end %>
</div>

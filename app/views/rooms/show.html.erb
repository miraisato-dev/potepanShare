<%# app/views/rooms/show.html.erb %>
<div data-controller="room-reservation">
<h1><%= @room.name %></h1>
  <div class="mb-3">
    <%= link_to "部屋一覧に戻る", rooms_path, class: "btn btn-secondary" %>

      <% if current_user && @room.user == current_user %>
        <%= link_to "編集", edit_room_path(@room), class: "btn btn-primary ml-2" %>

        <%= link_to "削除",
              room_path(@room),
              method: :delete,
              data: { confirm: "本当に削除しますか？" },
              class: "btn btn-danger ml-2" %>
    <% end %>
  </div>
  
    <% if current_user %>
      <h2>予約する</h2>

      <div id="price-data" data-price="<%= @room.price %>"></div>
  
      <% if @room.image.attached? %>
        <%= image_tag @room.image, class: "room-image-large" %>
      <% else %>
        <%= image_tag "default_room.png", class: "room-image-large" %>
      <% end %>

      <%= form_with model: Reservation.new,
            url: confirm_room_reservations_path(@room),
            local: true,
            data: { turbo: false } do |f| %>
  
        <p>
          <strong>チェックイン：</strong>
          <!-- type="text" にする dateにするとturboで動かない-->
          <%= f.text_field :start_date,
          id: "start_date",
          autocomplete: "off",
          placeholder: "yyyy/mm/dd" %>
        </p>
  
        <p>
          <strong>チェックアウト：</strong>
          <%= f.text_field :end_date,
          id: "end_date",
          autocomplete: "off",
          placeholder: "yyyy/mm/dd" %>
        </p>

        <p>
          <strong>人数：</strong>
          <%= f.number_field :guest_count,
                min: 1,
                value: 1,
                id: "guest_count" %> 人
        </p>

        <p>
          <strong>料金：</strong>
          <span id="price-per-night"><%= @room.price %></span> 円 / 人 / 泊
        </p>

        <p>
          <strong>合計金額：</strong>
          <span id="total-price">0</span> 円
        </p>

        <%= f.submit "予約する", class: "btn btn-primary" %>
      <% end %>
  
      <!-- 予約済み日データ -->
      <div id="booked-dates" data-dates="<%= @room.booked_dates.map(&:to_s).join(',') %>"></div>
    <% else %>
      <%= link_to "ログインして予約", login_path, class: "btn btn-warning" %>
    <% end %>
</div>
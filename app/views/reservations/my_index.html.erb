<%# app/views/reservations/my_index.html.erb %>
<h1 class="page-title">マイ予約一覧</h1>

<% if @reservations.any? %>
  <div class="table-wrapper">
    <table class="reservations-table">
      <thead>
        <tr>
          <th>画像</th>
          <th>施設名</th>
          <th>紹介文</th>          
          <th>合計料金</th>
          <th>チェックイン</th>
          <th>チェックアウト</th>
          <th>予約確定日時</th>
          <th><th>
        </tr>
      </thead>

      <tbody>
        <% @reservations.each do |reservation| %>

          <tr>
            <%# 画像 %>
            <td class="room-image">
              <% if reservation.room.image.attached? %>
                <%= image_tag reservation.room.image.variant(resize_to_limit: [100, 100]), alt: reservation.room.name %>
              <% else %>
                <span>画像なし</span>
              <% end %>
            </td>

            <%# 施設名 %>
            <td class="room-name">
              <%= link_to reservation.room.name, room_path(reservation.room) %>
            </td>

            <%# 紹介文 %>
            <td class="room-description">
              <%= reservation.room.description %>
            </td>

            <%# 合計料金 %>
            <td class="price">
              <%= number_to_currency(reservation.total_price.round, unit: "¥", precision: 0) %>
            </td>

            <%# チェックインアウト %>
            <td><%= reservation.start_date.strftime("%Y/%m/%d") %></td>
            <td><%= reservation.end_date.strftime("%Y/%m/%d") %></td>

            <%# 予約確定日時 %>
            <td><%= reservation.created_at.in_time_zone("Tokyo").strftime("%Y/%m/%d %H:%M") %></td>

            <td>
              <div class="reservation-dropdown-wrapper" data-controller="reservation-dropdown">
                <!-- SVG をクリックしてメニューを開閉 -->
                <button class="reservation-dropdown-toggle btn btn-link p-0" type="button">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" width="20" height="20" fill="currentColor">
                    <path d="M320 208C289.1 208 264 182.9 264 152C264 121.1 289.1 96 320 96C350.9 96 376 121.1 376 152C376 182.9 350.9 208 320 208zM320 432C350.9 432 376 457.1 376 488C376 518.9 350.9 544 320 544C289.1 544 264 518.9 264 488C264 457.1 289.1 432 320 432zM376 320C376 350.9 350.9 376 320 376C289.1 376 264 350.9 264 320C264 289.1 289.1 264 320 264C350.9 264 376 289.1 376 320z"/>
                  </svg>
                </button>

                <ul class="reservation-dropdown-menu">
                  <li><%# 再予約 %>
                    <%= link_to "再予約", room_path(reservation.room), class: "dropdown-item" %>
                  </li>
                  <li>
                    <%# 予約を削除 %>
                    <%= link_to "予約を削除",
                          room_reservation_path(reservation.room, reservation),
                          data: {
                            turbo_method: :delete,
                            turbo_confirm: "本当に予約を削除しますか？"
                          },
                          class: "dropdown-item text-danger" %>
                  </li>
                </ul>
              </div>
            </td>

          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <p>予約はまだありません。</p>
<% end %>